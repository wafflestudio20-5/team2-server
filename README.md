

![ktlint check](https://github.com/wafflestudio20-5/team2-server/actions/workflows/ktlint_check.yml/badge.svg)
[![Deploy](https://github.com/wafflestudio20-5/team2-server/actions/workflows/deploy.yml/badge.svg)](https://github.com/wafflestudio20-5/team2-server/actions/workflows/deploy.yml)

<div align="center">
   <a href="https://github.com/wafflestudio/team2-server">
    <img src="https://user-images.githubusercontent.com/86216809/216102204-712654a2-13e1-46f5-89c3-0cd68ea590d7.jpg" alt="Logo" width="150" height="150">
  </a>
   
   <p>
      <span style="font-size: x-large; font-weight: bold">지식2n</span></br>
      <q style="font-size: medium">세상의 모든 질문에는 답변이 있다.</q>
   </p>
   <p align="center">
   <div style=" padding-bottom: 1rem;">
         <span style="font-size: large;font-weight: bold">Stack</span><br>
         <img src="https://img.shields.io/badge/iOS-000000?style=for-the-badge&logo=Apple&logoColor=white" />
         <img src="https://img.shields.io/badge/Swift-F05138?style=for-the-badge&logo=Swift&logoColor=white" />
         <img src="https://img.shields.io/badge/UIKit-2396F3?style=for-the-badge&logo=UIKit&logoColor=white" />
         <img src="https://img.shields.io/badge/Fastlane-68BD49?style=for-the-badge&logo=fastlane&logoColor=white"/>
         <img src="https://img.shields.io/badge/GitHub Actions-2088FF?style=for-the-badge&logo=GitHub Actions&logoColor=white" /> </br>
         <img src="https://img.shields.io/badge/Spring-60B33F?style=for-the-badge&logo=Spring&logoColor=white" />
         <img src="https://img.shields.io/badge/Kotlin-7F52FF?style=for-the-badge&logo=Kotlin&logoColor=white" />
         <img src="https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=Docker&logoColor=white" />
         <img src="https://img.shields.io/badge/EC2-FF9900?style=for-the-badge&logo=Amazon EC2&logoColor=white" />
         <img src="https://img.shields.io/badge/RDS-527FFF?style=for-the-badge&logo=Amazon RDS&logoColor=white" />
         <img src="https://img.shields.io/badge/S3-569A31?style=for-the-badge&logo=Amazon S3&logoColor=white" />
         <img src="https://img.shields.io/badge/MySQL-4479A1?style=for-the-badge&logo=MySQL&logoColor=white" /> </br>
         <img src="https://img.shields.io/badge/Github-181717?style=for-the-badge&logo=Github&logoColor=white" />
         <img src="https://img.shields.io/badge/Notion-000000?style=for-the-badge&logo=Notion&logoColor=white" />
         <img src="https://img.shields.io/badge/Slack-4A154B?style=for-the-badge&logo=Slack&logoColor=white" />
         <img src="https://img.shields.io/badge/Postman-FF6C37?style=for-the-badge&logo=Postman&logoColor=white"/></br>
         <a href="https://github.com/wafflestudio/team2-server/issues">Request Feature</a>
    ·
    <a href="https://github.com/wafflestudio/team2-server/issues">Report Bug</a>
    ·
    <a href="https://wafflestudio.com/">Wafflestudio</a>
   </div>
   </p>
</div>


앱 소개
![지식인소개3](https://user-images.githubusercontent.com/86216809/216120258-43bcc3c8-0067-4de2-b01f-56861b400243.jpg)
지식2n은 "세상의 모든 질문에는 답변이 있다"는 캐치프레이즈를 가진, 질문하고 답변하는 앱입니다.<br>
이 공간에서 여러분들은 어떠한 궁금한 거라도 질문할 수 있고, 내가 알고 있는 어떤 지식도 답변을 달 수 있습니다.<br>
저희 앱의 이름의 유래는 '세상에 질문이 n개 있다면, 그에 대한 답변도 n개 있지 않을까?','그렇다면 총 2n개의 글이 달리지 않을까?'에서 시작했습니다.<br>
Team2에서 만든 공간에서 즐겁게 뛰어놀아 주세요.<br>

누가 만들었나요?<br>
Spring developer: 우혁준, 이지원, 조성규<br>
iOS developer: 김령교, 박정헌, 박채현, 홍희주<br>

워크플로우&프로젝트 뷰<br>
핵심적인 기능들을 추린 워크플로우는 다음과 같습니다.<br>
![워크플로우1페이지2](https://user-images.githubusercontent.com/86216809/216283042-1a5b266e-5d3b-4941-b51d-87a39b9b4e1d.jpg)
![워크플로우2페이지](https://user-images.githubusercontent.com/86216809/216114406-4a345997-a87d-4155-8893-a808e502a5e6.jpg)
![워크플로우3페이지](https://user-images.githubusercontent.com/86216809/216114630-658381d7-23e4-47d4-944e-9e3a0cebeddb.jpg)


지식2n 사용 설명서

지식2n에는 다양한 기능이 있지만, 그중에서 가장 핵심적인 기능은 "질문하고, 답변해서, 반응하기"라고 할 수 있습니다.<br>
Team2는 이 과정을 어떻게 구현하였을까요?<br>
시연에서는 직접 두눈으로 보여드렸지만, 다른 팀꺼 본다고/직접 발표한다고/개인상의 일정 때문에 등등의 이유로 못 본 분들을 위해!<br>
지식2n 리드미에서 핵심 기능이 무엇인지 깔끔하게 설명해드리겠습니다 :blush:<br>


![사용설명서1페이지](https://user-images.githubusercontent.com/86216809/216321167-7e3a28c6-46fb-4d1c-a961-bd693f13a139.jpg)
![사용설명서2페이지](https://user-images.githubusercontent.com/86216809/216321186-a7a7fcd2-670a-4dae-83ad-20a309e47f4e.jpg)
![사용설명서3페이지](https://user-images.githubusercontent.com/86216809/216321205-f6921b59-d910-43c9-92fb-b2f3cb6ebb11.jpg)
![사용설명서4페이지](https://user-images.githubusercontent.com/86216809/216321218-4e7bab7c-62e4-4a16-9d3f-fbbfe6336906.jpg)


이외에도 다음과 같이 다양한 기능을 담았습니다.

![다양한기능1페이지](https://user-images.githubusercontent.com/86216809/216355237-d36ad792-eba0-47f8-b712-eaab34aeb8ea.jpg)
![다양한기능2페이지](https://user-images.githubusercontent.com/86216809/216355256-ae32178c-2881-4f6a-8240-3b9d62e64b13.jpg)
![다양한기능3페이지](https://user-images.githubusercontent.com/86216809/216355280-922da1b6-29a4-45b0-9fec-7cd5143635cb.jpg)
![다양한기능4페이지](https://user-images.githubusercontent.com/86216809/216355299-cf1234c9-eb32-4e55-896b-c1e71f2776eb.jpg)
![다양한기능5페이지](https://user-images.githubusercontent.com/86216809/216355327-c88b3d7b-e473-49de-b2ae-a2463390bde2.jpg)


우리, 이것도 구현했다!

지식2n을 만들면서 기능적으로 여러 난관을 겪었습니다.<br>
처음에 난관을 만났을 때는 우왕좌왕했지만, 구글링도 하고 다른 사람들과 지식을 공유하면서 난관들을 하나씩 극복해갔습니다.<br>
그러한 시련과 극복을 거친 끝에, 이렇게 멋있는 앱이 탄생할 수 있었습니다.

아래의 글부터는, 지식2n에서 자랑하고 싶은 내용을 하나씩 짚어가며 소개하고자 합니다.<br>
Team2 리드미의 하이라이트라고 볼 수 있을 것 같네요 :blush:<br>
그러면 지금부터 시작하겠습니다!<br>
(아래의 사진부터는 발표 자료로, 발표 자료를 보강하는 내용을 글로 적도록 하겠습니다.)


소셜 로그인(카카오)
   ![구현_카카오로그인](https://user-images.githubusercontent.com/86216809/216363896-10e9e3b3-b943-44f7-907f-ec0c4985df6a.jpg)
    와플 토이프로젝트를 만들며 필수적으로 해결하라고 한 요소 중 하나였던 카카오 로그인!<br>
    지식2n에서는 다양한 소셜 로그인 중 카카오 로그인을 도입하였습니다.<br>
    우선 Team2는 Kakao Developer에 통해 지식2n 앱을 등록하고, iOS를 기반으로 하고 있기 때문에 iOS 플랫폼을 도입하였습니다.<br>
    카카오 로그인에서 정말 중요하게 다뤄지는 것 중 하나가 토큰인데요, 토큰을 주고받는 순서를 간단히 잡으면<br>
    'iOS는 카카오 토큰을 받음->받은 카카오 토큰을 스프링에 전달->스프링은 다시 카카오한테 토큰을 줘서 유저 정보를 전달받음->전달받은 유저 정보를 스프링 db에 전달'<br>
    순서로 전개됩니다.<br>
    이 과정을 통해, 지식2n에서도 카카오 유저의 필요한 정보들을 받을 수 있고, 버튼 하나를 클릭하면서 간단하게 로그인을 실행시킬 수 있습니다.


정렬&페이지네이션
   ![구현_정렬페이지네이션](https://user-images.githubusercontent.com/86216809/216401869-81343a47-2a59-4f24-92b7-1b09afb1621d.jpg)
   답변하기, 나의질문 등 지식2n에서는 다양한 질문을 다루어야 하기 때문에, 기준에 따른 정렬과 페이지네이션이 중요합니다.<br>
   이를 구현하기 위해 QueryDsl을 적극적으로 사용하였으며, 자세히 살펴보면<br>
   orderBy와 desc를 통해 최신순, 좋아요순, 답변수순을 통해 질문들을 역방향으로 정렬하였으며(답변수순은 앱 미반영)<br>
   offset(page*amount), limit(amount)를 통해 각 페이지 첫번째 글부터 amount 번째까지의 글을 불러오도록 하였습니다.


Https
   ![구현_https1페이지](https://user-images.githubusercontent.com/86216809/216403204-103aa762-fe35-4f1d-aa7a-412348a5a131.jpg)
   ![구현_https2페이지](https://user-images.githubusercontent.com/86216809/216403249-5a4d6183-b3c2-4b79-9b8f-758b24df7719.jpg)
   Https(Hypertext Transfer Protocol Secure)는 Http에 SSL 보안을 얹은 것으로, Http에 비해 보안성과 사이트 로딩 속도가 뛰어납니다.<br>
   Https 구현을 설명하기 위해서는 먼저 알아둬야할 건, 저희는 AWS의 Elastic Beanstalk를 통해 백 서버를 배포시켰습니다.<br>
   Elastic Beanstalk는 Docker를 통한 EC2 배포, AWS 데이터베이스인 RDS를 하나로 묶어 구성할 뿐만 아니라<br>
   로드 밸런싱, 프로비저닝, 오토 스케일링 등 앱의 최적화를 위해 필요한 작업들을 자동으로 해줍니다.<br>
   여기에서 Https와 관련이 깊은 것은 로드 밸런싱으로, 로드 밸런싱은 트래픽이 많은 서버의 과부화를 방지하기 위해<br>
   트래픽을 여러 서버에 균등하게 분배하는 역할을 하고 있습니다.<br>
   Https을 연결하기 위해서, 구매한 도메인을 Route 53에 등록한 이후 도메인을 Elastic Beanstalk의 로드 밸런서와 DNS를 연결시켰습니다.<br>
   또한 Amazon Certificate Manager를 통해 연결이 잘 이뤄지도록 인증서를 발급받았습니다.


인증과 권한
   ![구현_인증과권한1페이지](https://user-images.githubusercontent.com/86216809/216519993-fbe4c25b-1991-423a-b39e-e9ae6de4731b.jpg)
   Interceptor는 서버로 들어온 Request가 컨트롤러의 Handler로 들어오기 전에 낚아채어 원하는 로직을 수행한 후 Handler로 보내는 역할을 합니다.<br>
   저희 팀은 초반에는 주로 Interceptor을 Authorization의 역할을 수행시켜,<br>
   토큰을 받으면 해당 토큰의 유저 정보가 있는지 검증하고, 만약 틀렸거나 토큰 자체가 없다면 예외를 반환시켰습니다.<br>

   하지만 개발을 할수록 이러한 로직에는 문제가 발생했습니다. 앞서 말했듯 Authorization의 Interceptor는 토큰이 없으면 예외를 반환시키는데,<br>
   만약 토큰이 있든 없든 각각의 결과값을 내놓아야 하면 어떻게 처리해야 할까요?<br>
   가령 하트 색깔에 대해서는 예를 들어봅시다. 로그인하지 않은 유저는 토큰이 없어도 상세질문에 접근할 수 있지만,<br>
   좋아요를 누른 유저는 그 유저의 토큰을 받아서 상세질문을 나갔다 다시 들어와도 분홍색으로 칠해져야 하지 않을까요?<br>
   
   이러한 상황은 토큰을 받아도 받지 않아도 유저의 정보를 추출하는 Authentication의 필요성을 부각시켰습니다.<br>
   하지만 지금의 인터셉터로는 토큰이 없다면 무작정 예외를 발생시키는 상황,<br>
   우리는 이 상황에서 어떻게 처리해야 할까요?


   ![구현_인증과권한2페이지](https://user-images.githubusercontent.com/86216809/216520514-99304581-f7b6-461b-87ce-c2ae110da9ca.jpg)
   저희는 이런 상황을 해결하기 위해 기존의 Interceptor를 분화시켜 AuthInterceptor1, AuthInterceptor2로 두 개를 만들었습니다.<br>
   그리고 AuthInterceptor1에서는 모든 Api에 접근하여 토큰이 있다면 유저 정보를, 토큰이 없다면 null을 반환하도록 하였고,<br>
   AuthInterceptor2에서는 특정 Api에 접근하여 유저 정보가 있다면 로직을 실행시키도록, null만 있다면 예외를 반환하도록 했습니다.<br>
   그리고 기존에 있던, 만료된 토큰은 401 예외를 반환(401 반환 즉시 프론트에서 재발급 요청)시키는 일과<br> 
   탈퇴한 유저의 토큰은 접근이 안되게 하도록 하는 일은 AuthInterceptor1에게 맡겼습니다.<br>
   이러한 과정을 통해, 질문등록/답변수정/프로필수정 등 Authorization이 필요한 일과<br> 
   하트색깔/채택하기버튼등장 같이 Authentication만 필요한 일 모두를 훌륭하게 소화하였습니다.<br>
   

스크롤뷰
   ![구현_스크롤뷰](https://user-images.githubusercontent.com/86216809/216526249-0f9caeb0-5ef6-4b0e-b8d7-ba66d9367953.jpg)
   지식2n을 처음 쓰는 분들이 제일 먼저 만나는 홈화면! 홈화면은 상단에서는 4개의 이미지를 옆으로 스와이프하며 원하는 이미지를 누를 수 있고,<br>
   하단에서는 나의 질문들을 아래로 스와이프하며 확인할 수 있습니다. 어떻게 한 화면에 두 방향의 스와이프가 가능할까요? <br>
   이걸 위해서 저희는 하나의 화면에 두개의 View를 걸어놨습니다.
   상단의 View에서는 ScrollView를 걸어놨고, 그 안에 4개의 이미지를 StackView로 묶어놔 StackView를 ScrollView 안에 넣었습니다.
   ScrollView는 자기보다 큰 이미지가 걸려있으면 스크롤을 할 수 있기 때문에, 높이는 같고 가로로만 긴 StackView는 횡스크롤을 하게 됩니다.

   반면에 아래쪽에 있는 나의 질문은 TableView를 걸어놓았습니다. 각각의 질문들이 마치 보이지 않는 선으로 이뤄진 표처럼 생겼는데요.
   TableView는 자신의 화면을 넘기면 자동으로 스크롤할 수 있게 하기 때문에 질문이 많이 쌓이면 아래로 스와이프를 할 수 있게 됩니다.
   

사진 업로드
   <p>
      <img src="https://user-images.githubusercontent.com/86216809/216584340-87c95c9d-b1b3-4ca0-83cd-593ef5c31974.jpg" width="49%">
      <img src="https://user-images.githubusercontent.com/86216809/216584438-7a0f3703-7abb-4520-a1cf-252adb7e677a.jpg" width="49%">
   <p>
   저희는 지식2n에서 필요한 사진들을 저장하기 위해 S3을 사용하였습니다. S3는 AWS에서 제공하는 파일 서버 서비스로,<br>
   사진들 뿐만 아니라 앱 압축 파일 등 다양한 데이터들을 S3에 저장하여 사용하였습니다.<br>
   S3을 사용하기 위해서는 서버와 S3 간의 통신이 중요한데, 이를 위해 S3 버킷을 만들고 스프링 서버와 연결하였어요.<br>
   사진을 보내기 위해서는 iOS에서 갖고 있는 사진을 스프링에 넘기고, 스프링은 다시 그걸 S3에 넘겨서 파일 이름을 전달받는 과정이 이루어져야 합니다.<br>
   저희는 프로필 사진을 추가할 때는 단독으로, 질문에 사진들을 올릴 때는 사진 순서에 맞게 order를 부여하여<br>
   원하는 순서대로 사진을 추가하고자 하였습니다.


사진 업로드 - 질문 수정할 때 사진들 없애기
   ![구현_여러장의사진](https://user-images.githubusercontent.com/86216809/216581707-ef5fbef0-f825-4f0a-8077-645e40056fef.jpg)
   사진 업로드의 응용 버전으로 들어가봅시다.
   3장의 사진과 함께 질문을 올렸는데, 그 중 2번째 사진을 삭제하면 어떻게 될까요?
   휴대폰에서 두번째 사진을 삭제하고 답변등록 버튼을 누르면, iOS에서는 삭제된 사진을 제외하고 남은 두개의 사진을 order에 맞게 List<String> 형태로 배열합니다.
   수정된 List<String>을 포함하여 질문을 스프링에 전송하면, 스프링은 삭제된 사진 리스트와 남은 사진 리스트 두개를 만듭니다.
   이러한 리스트 두개를 S3에 보내면, S3는 삭제된 사진 객체들은 제거하고 남은 사진들은 다시 저장합니다.
   (이때, uuid는 다시 다르게 설정되기 때문에 남은 사진들도 객체 이름은 바뀝니다.)
   그렇게 다시 남은 사진들을 스프링으로 반환하고, 스프링은 다시 수정된 사진 리스트를 